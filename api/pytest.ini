[pytest]
# Django API Testing Configuration with Testcontainers
minversion = 6.0
addopts =
    -p no:pytest_postgresql
    -ra
    --strict-markers
    --strict-config
    --disable-warnings
    -v
    --tb=short
    --reuse-db
    --cov=authentication
    --cov=blockchain
    --cov=organizations
    --cov=ekko_api
    --cov=app
    --cov-report=html:htmlcov
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=40
    --maxfail=10

# Django settings
DJANGO_SETTINGS_MODULE = ekko_api.settings.test
pythonpath = .
python_files = test_*.py
python_classes = Test*
python_functions = test_*
testpaths = tests app/tests
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    auth: marks tests related to authentication
    blockchain: marks tests related to blockchain functionality
    organizations: marks tests related to organization management
    database: marks tests that require database
    api: marks tests for API endpoints
    redis: marks tests that require Redis
    nats: marks tests that require NATS
    alerts: marks tests for alert system functionality
    templates: marks tests for alert template functionality
    jobs: marks tests for job queue functionality
    services: marks tests for service layer functionality
    models: marks tests for Django models
    serializers: marks tests for DRF serializers
    views: marks tests for API views
    webauthn: marks tests for WebAuthn/passkey functionality
    magic_links: marks tests for email magic link authentication
    totp: marks tests for TOTP 2FA functionality
    security: marks tests for security features
    performance: marks tests for performance benchmarking
    factories: marks tests for factory functionality
    admin: marks tests for Django admin functionality
    admin_blockchain: marks tests for blockchain node admin
    admin_nats: marks tests for NATS control admin
    admin_dashboard: marks tests for real-time dashboard admin
    admin_infrastructure: marks tests for infrastructure monitoring admin
    admin_audit: marks tests for audit and compliance admin
    admin_alerts: marks tests for alert system admin
# Test discovery
norecursedirs = .git .tox dist build *.egg htmlcov venv venv-django node_modules

# Django-specific settings
django_find_project = false

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::pytest.PytestUnraisableExceptionWarning

# Asyncio mode for NATS testing
asyncio_mode = auto
