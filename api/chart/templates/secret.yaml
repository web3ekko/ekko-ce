{{- $api := default dict .Values.api -}}
{{- $apiEmail := default dict $api.email -}}
{{- $django := default dict .Values.django -}}
{{- $jwt := default dict .Values.jwt -}}
{{- $postgres := default dict .Values.postgresql -}}
{{- $database := default dict .Values.database -}}
{{- $redis := default dict .Values.redis -}}
{{- $email := default dict .Values.email -}}
{{- $external := default dict .Values.externalServices -}}
{{- $blockchain := default dict .Values.blockchain -}}
{{- $notifications := default dict .Values.notifications -}}
{{- $telegram := default dict $notifications.telegram -}}
{{- $discord := default dict $notifications.discord -}}
{{- $slack := default dict $notifications.slack -}}
{{- $monitoring := default dict .Values.monitoring -}}
{{- $sentry := default dict $monitoring.sentry -}}
{{- $neo4j := default dict .Values.neo4j -}}
{{- $firebase := default dict .Values.firebase -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "ekko-api.fullname" . }}
  labels:
    {{- include "ekko-api.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Django Secret Key
  DJANGO_SECRET_KEY: {{ $django.secretKey | default "django-insecure-change-me-in-production" | quote }}

  # JWT Secret Key
  JWT_SECRET_KEY: {{ $jwt.secretKey | default "jwt-secret-change-me-in-production" | quote }}

  # Database Credentials
  POSTGRES_PASSWORD: {{ $postgres.password | default "changeme" | quote }}
  DATABASE_URL: {{ $database.url | default (printf "postgresql://%s:%s@%s:%s/%s" ($postgres.username | default "ekko") ($postgres.password | default "changeme") ($postgres.host | default "postgres") ($postgres.port | default "5432") ($postgres.database | default "ekko")) | quote }}

  # Redis Credentials
  REDIS_PASSWORD: {{ $redis.password | default "" | quote }}
  REDIS_URL: {{ $redis.url | default (printf "redis://:%s@%s:%s/0" ($redis.password | default "") ($redis.host | default "redis") ($redis.port | default "6379")) | quote }}

  # Email Credentials
  EMAIL_HOST_PASSWORD: {{ $email.password | default "" | quote }}
  RESEND_API_KEY: {{ $apiEmail.resendApiKey | default "" | quote }}

  # External Services
  OPENAI_API_KEY: {{ $external.openaiApiKey | default "" | quote }}
  ANTHROPIC_API_KEY: {{ $external.anthropicApiKey | default "" | quote }}
  GEMINI_API_KEY: {{ $external.geminiApiKey | default "" | quote }}
  GOOGLE_API_KEY: {{ $external.geminiApiKey | default "" | quote }}
  GEMINI_MODEL: {{ $external.geminiModel | default "" | quote }}

  # Blockchain RPC URL
  BLOCKCHAIN_RPC_URL: {{ $blockchain.rpcUrl | default "" | quote }}

  # Notification Services
  TELEGRAM_BOT_TOKEN: {{ $telegram.botToken | default "" | quote }}
  DISCORD_WEBHOOK_URL: {{ $discord.webhookUrl | default "" | quote }}
  SLACK_WEBHOOK_URL: {{ $slack.webhookUrl | default "" | quote }}

  # Monitoring
  SENTRY_DSN: {{ $sentry.dsn | default "" | quote }}

  # Neo4j Credentials (for Graphiti integration)
  GRAPHITI_NEO4J_PASSWORD: {{ $neo4j.password | default "" | quote }}

  # Firebase Service Account Credentials
  {{- if $firebase.serviceAccountKey }}
  FIREBASE_SERVICE_ACCOUNT_KEY: {{ $firebase.serviceAccountKey | quote }}
  {{- end }}
